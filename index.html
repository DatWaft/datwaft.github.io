<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Towers Game</title>
    <style>
      * { padding: 0; margin: 0; }
      canvas {
        background: #eee;
        position:fixed;
        left:0;
        top:0;
        width:100%;
        height:100%;
      }
 audios apis javascript   </style>
</head>
<body>

<canvas id="canvas"></canvas>

<script>
// Music.
  var begin = false;
  function playMusic()
  {
    if(begin == false)
    {
      var music = new Audio('music.mp3');
      music.play()
      music.volume = 0.3;
      begin = true;
      return false;
    }
    return true;
  }
// Context initialization.
  var canvas = document.getElementById("canvas");
  canvas.width = canvas.clientWidth;
  canvas.height = canvas.clientHeight;
  var ctx = canvas.getContext("2d");
// Loop declaration.
  function init()
  {
    if(reset || !begin)
    {
      height = 1;
      blocks = [];
      position = 0;
      lost = false;
      reset = false;
      enter = false;
      currentSize = width/2;
    }
    else
    {
      step();
    }
    draw();
    if(!lost && !(size.h == height))
      setTimeout(init, 1000/(height + 2));
  };
// Event Listener.
  document.addEventListener("keypress", keypressHandler, false);
  document.addEventListener("touchstart", keypressHandler, false);
// Event Handler.
  var enter = false;
  var reset = false;
  function keypressHandler(e)
  {
    if(!playMusic())
    {
      return;
    }
    enter = true;
    if(lost || size.h == height)
    {
      reset = true;
      init();
    }
  }
// Game variables.
  var maximum_height = 20;
  var width = 10;
  var currentSize = width/2;
  var blocks = [];
  var position = 0;
  var direction = '->';

  var lost = false;

  var height = 1;
  var actual_color = getRandomColor();
// Display variables.
  var center = 
  {
    x: canvas.width / 2,
    y: canvas.height / 2
  };
  var total_cell = canvas.height / (maximum_height + 6);
  var cell = {l: Math.round(total_cell * 8 / 10), p: Math.round(total_cell * 2 / 10)};
  var size = {w: width, h: 20};
  var rect =
  {
    x: center.x - ((cell.l + cell.p) * size.w)/2,
    y: center.y - ((cell.l + cell.p) * size.h)/2,
    w: (cell.l + cell.p) * size.w,
    h: (cell.l + cell.p) * size.h
  };
// Logic functions.
  function step()
  {
    if(enter)
    {
      var x = (blocks.length > 0 ? blocks[blocks.length - 1].x : 0);
      var s = (blocks.length > 0 ? blocks[blocks.length - 1].s : width);
      var new_pos = Math.max(x, position);
      var overlap = Math.max(0, Math.min(position + currentSize, x + s) -
        Math.max(position, x));
      if(overlap == 0)
      {
        lost = true;
      }
      else
      {
        blocks.push({x: new_pos, s: overlap, color: actual_color});
        currentSize = overlap;
        actual_color = getRandomColor();
      }
      enter = false;
      height += 1;
    }
    else
    {
      if(position == width - currentSize)
      {
        direction = '<-';
      }
      if(position == 0)
      {
        direction = '->'
      }
      if(direction == '<-')
      {
        position -= 1;
      }
      else
      {
        position += 1;
      }
    }
  }
// Drawing functions.
  function getRandomColor() 
  {
    var letters = '0123456789ABCDEF';
    var color = '#';
    for (var i = 0; i < 6; i++) 
    {
      color += letters[Math.floor(Math.random() * 16)];
    }
    if (color == "FFFFFF")
    {
      color = "000000"
    }
    return color;
  }
  function drawBegin()
  {
    ctx.beginPath();
    ctx.rect(rect.x - total_cell, rect.y - total_cell, rect.w + total_cell*2,
      rect.h + total_cell*2);
    ctx.strokeStyle = "#000";
    ctx.fillStyle = "#fff";
    ctx.stroke();
    ctx.font = "30px Georgia";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillStyle = "red";
    ctx.fillText("Press to begin",rect.x - total_cell + ((rect.w +
      total_cell*2)/2),rect.y - total_cell + ((rect.h + total_cell*2)/2));
    ctx.closePath();
  }
  function drawLost()
  {
    ctx.beginPath();
    ctx.rect(rect.x - total_cell, rect.y - total_cell, rect.w + total_cell*2,
      rect.h + total_cell*2);
    ctx.strokeStyle = "#000";
    ctx.fillStyle = "#fff";
    ctx.stroke();
    ctx.font = "30px Georgia";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillStyle = "red";
    ctx.fillText("You lost! :c",rect.x - total_cell + ((rect.w +
      total_cell*2)/2),rect.y - total_cell + ((rect.h + total_cell*2)/2));
    ctx.closePath();
  }
  function drawWon()
  {
    ctx.beginPath();
    ctx.rect(rect.x - total_cell, rect.y - total_cell, rect.w + total_cell*2,
      rect.h + total_cell*2);
    ctx.strokeStyle = "#000";
    ctx.fillStyle = "#fff";
    ctx.stroke();
    ctx.font = "30px Georgia";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillStyle = "green";
    ctx.fillText("You won! :D",rect.x - total_cell + ((rect.w +
      total_cell*2)/2),rect.y - total_cell + ((rect.h + total_cell*2)/2));
    ctx.closePath();
  }
  function drawBlock()
  {
    for(let i = position; i < position + currentSize; i++)
    {
      ctx.beginPath();
      ctx.rect(rect.x + total_cell/3 + i * (cell.l + cell.p) - cell.p, rect.y +
        total_cell/3 + (size.h - height) * (cell.l + cell.p) - cell.p, cell.l,
        cell.l);
      ctx.fillStyle = actual_color;
      ctx.fill();
      ctx.closePath();
    }
  }
  function drawBuilding()
  {
    for(let j = 0; j < blocks.length; j++)
    {
      for(let i = blocks[j].x; i < blocks[j].x + blocks[j].s; i++)
      {
        ctx.beginPath();
        ctx.rect(rect.x + total_cell/3 + i * (cell.l + cell.p) - cell.p, rect.y
          + total_cell/3 + (size.h - height + (blocks.length - j)) * 
          (cell.l + cell.p) - cell.p, cell.l, cell.l);
        ctx.fillStyle = blocks[j].color;
        ctx.fill();
        ctx.closePath();
      }
    }
  }
  function draw()
  {
    ctx.clearRect(0,0, canvas.width, canvas.height);

    ctx.beginPath();
    ctx.rect(rect.x - total_cell, rect.y - total_cell, rect.w + total_cell*2,
      rect.h + total_cell*2);
    ctx.fillStyle = "#fff";
    ctx.fill();
    ctx.rect(rect.x - total_cell, rect.y - total_cell, rect.w + total_cell*2,
      rect.h + total_cell*2);
    ctx.strokeStyle = "#000";
    ctx.fillStyle = "#fff";
    ctx.stroke();
    ctx.closePath();

    ctx.beginPath();
    ctx.font = "20px Georgia";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillStyle = "green";
    var text = {
      x: rect.x - total_cell,
      y: rect.y + rect.h + total_cell + 5,
      w: rect.w + total_cell * 2,
      h: total_cell
    }
    ctx.fillText("Points: " + height, text.x + (text.w/2), text.y + (text.h/2));
    var text = {
      x: rect.x - total_cell,
      y: rect.y - total_cell * 2 - 5,
      w: rect.w + total_cell * 2,
      h: total_cell
    }
    ctx.fillStyle = "blue";
    ctx.fillText("Towers Game", text.x + (text.w/2), text.y + (text.h/2));
    ctx.closePath();
    if(!begin)
    {
      drawBegin();
    }
    else if(lost || currentSize == 0)
    {
      drawLost();
    }
    else if(height == size.h)
    {
      drawWon();
    }
    else
    {
      drawBlock();
      drawBuilding();
    }
  }
  init();
</script>

</body>
</html>
